"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[21],{8747:(e,t,r)=>{r.d(t,{Z:()=>p});var n=r(5281),a=r(8310),s=r(1660),o=r(7313),i=r(4511),l=r(4395),c=r(6060),u=r(3135);var d=r(6417);const p=e=>{let{stops:t,isFocus:r}=e;const p=(e=>{let{stopKeys:t,disabled:r=!1}=e;const{db:{routeList:n,stopList:a,serviceDayMap:s},isVisible:d,refreshInterval:p,isRouteFilter:h,isTodayHoliday:g}=(0,o.useContext)(c.ZP),v=(0,o.useMemo)((()=>t.reduce(((e,t)=>{let[r]=t;return"lightRail"===r}),!1)),[t]),x=(0,o.useMemo)((()=>Object.entries(n).reduce(((e,r)=>{let[n,{stops:a,freq:o}]=r;return h&&!(0,u.x4)(n,o,g,s)||t.forEach((t=>{var r;let[s,o]=t;null===(r=a[s])||void 0===r||r.forEach(((t,r)=>{t===o&&e.push([n,r])}))})),e}),[]).map((e=>e.join("|"))).filter(((e,t,r)=>r.indexOf(e)===t)).map((e=>e.split("|")))),[t,n,h,g,s]),[m,f]=(0,o.useState)([]),{i18n:{language:b}}=(0,i.$)(),k=(0,o.useRef)(!1),Z=(0,o.useCallback)((()=>!d||r||"prerendering"===navigator.userAgent?(f([]),new Promise((e=>e([])))):Promise.all(x.map((e=>{let[t,r]=e;return(0,l.Gx)({...n[t],seq:parseInt(r,10),stopList:a,language:b})}))).then((e=>{k.current&&f(e.map(((e,t)=>[x[t].join("/"),e.filter((e=>{let{co:r,dest:a}=e;return"mtr"!==r||a.zh===n[x[t][0]].dest.zh}))])).sort(((e,t)=>{let[r,n]=e,[a,s]=t;return 0===n.length?1:0===s.length?-1:v?n[0].remark.zh===s[0].remark.zh?n[0].eta<s[0].eta?-1:1:n[0].remark.zh<s[0].remark.zh?-1:1:n[0].eta===s[0].eta?r<a?-1:1:n[0].eta<s[0].eta?-1:1})))}))),[d,r,b,n,a,x,v]);return(0,o.useEffect)((()=>{k.current=!0;const e=setInterval((()=>{Z()}),p);return Z(),()=>{k.current=!1,clearInterval(e)}}),[Z,p]),m})({stopKeys:t,disabled:!r});return 0===p.length?(0,d.jsx)(n.Z,{sx:{my:5}}):(0,d.jsx)(a.Z,{children:p.map((e=>{let[t,r]=e;return(0,d.jsx)(s.Z,{routeId:t,etas:r},t)}))})}},5439:(e,t,r)=>{r.d(t,{Z:()=>c});r(7313);var n=r(501),a=r(1113),s=r(4511),o=r(2286),i=r(7822),l=r(6417);const c=()=>{const{t:e}=(0,s.$)(),t=(0,o.GE)();return"prerendering"!==navigator.userAgent&&t&&(t.WTCSGNL&&u.includes(t.WTCSGNL.code)||t.WRAIN&&d.includes(t.WRAIN.code))?(0,l.jsxs)(n.Z,{variant:"outlined",sx:p,onClick:()=>window.open(e("bad-weather-link"),"_target"),children:[(0,l.jsx)(i.Z,{color:"error"}),(0,l.jsx)(a.Z,{children:e("bad-weather-text")})]}):null},u=["TC8NE","TC8SE","TC8NW","TC8SW","TC9","TC10"],d=["WARINR","WRAINB"],p={borderRadius:e=>e.shape.borderRadius,cursor:"pointer",px:2,py:1,display:"flex",alignItems:"center",textAlign:"left",gap:1}},9004:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(7313),a=r(3428),s=r(4183),o=r(3405),i=r(1113),l=r(4511),c=r(6060),u=r(6417);const d=()=>{const{t:e}=(0,l.$)(),{db:{updateTime:t},renewDb:r}=(0,n.useContext)(c.ZP),d=(0,n.useMemo)((()=>Date.now()>t+24192e5),[t]);return"prerendering"!==navigator.userAgent&&d?(0,u.jsx)(a.Z,{variant:"outlined",sx:p,onClick:r,children:(0,u.jsx)(s.Z,{children:(0,u.jsx)(o.Z,{children:(0,u.jsx)(i.Z,{children:e("db-renew-text")})})})}):null},p={borderRadius:e=>e.shape.borderRadius,margin:.2,height:"100%",display:"flex"}},6021:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var n=r(7313),a=r(6060),s=r(501),o=r(7829),i=r(5439),l=r(9004),c=r(1113),u=r(8485),d=r(5280),p=r(4511),h=r(6417);const g=e=>{let{stopTab:t,onChangeTab:r}=e;const{t:s,i18n:{language:o}}=(0,p.$)(),{db:{stopList:i},savedStops:l}=(0,n.useContext)(a.ZP);return 0===l.length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Z,{variant:"h6",children:s("\u672a\u6709\u6536\u85cf\u8eca\u7ad9")}),(0,h.jsx)(c.Z,{variant:"body1",children:s("\u8acb\u6309\u4e0b\u5716\u6307\u793a\u589e\u52a0")})]}):(0,h.jsx)(u.Z,{value:t,onChange:(e,t)=>r(t,!0),sx:v,variant:"scrollable",scrollButtons:!0,children:l.map((e=>e.split("|"))).filter((e=>{let[t,r]=e;return i[r]})).map(((e,t)=>{let[r,n]=e;return(0,h.jsx)(d.Z,{label:i[n].name[o],value:"".concat(r,"|").concat(n),disableRipple:!0},"stops-".concat(n))}))})},v={background:e=>e.palette.background.default,minHeight:"36px","& .MuiTab-root":{alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px"},"& .MuiTabs-flexContainer":{justifyContent:"flex-start"}};var x=r(2547),m=r(8747);const f=n.forwardRef(((e,t)=>{let{stopTab:r,onChangeTab:s}=e;const{db:{stopList:o,stopMap:i},savedStops:l}=(0,n.useContext)(a.ZP),c=(0,n.useRef)(r);(0,n.useImperativeHandle)(t,(()=>({changeTab:e=>{c.current=e}})));const u=(0,n.useMemo)((()=>l.filter((e=>e.split("|")[1]in o))),[l,o]),d=(0,n.useCallback)((()=>{let e=u.indexOf(c.current);return-1!==e?e:-1}),[u]),p=(0,n.useMemo)((()=>u.map((e=>{var t;if(""===e)return[];const r=[e.split("|")];return null===(t=i[r[0][1]])||void 0===t||t.forEach((e=>r.push(e))),r}))),[u,i]);return(0,h.jsx)(x.ZP,{index:d(),onChangeIndex:e=>{s(u[e])},children:p.map(((e,t)=>(0,h.jsx)(m.Z,{stops:e,isFocus:d()===t},"savedStops-".concat(t))))})})),b=()=>{const{savedStops:e,db:{stopList:t},colorMode:r}=(0,n.useContext)(a.ZP),{i18n:{language:c}}=(0,p.$)(),u=(0,n.useRef)(null),d=(0,n.useMemo)((()=>{try{var r;const n=null!==(r=localStorage.getItem("stopTab"))&&void 0!==r?r:"|";if(n&&e.includes(n)&&t[n.split("|")[1]])return n;for(let r=0;r<e.length;++r){let n=e[r].split("|")[1];if(t[n])return e[r]}}catch(n){console.error(n)}return""}),[e,t]),[v,x]=(0,n.useState)(d),m=(0,n.useCallback)((e=>""===v?"unset":"dark"===e.palette.mode?e.palette.background.default:"white"),[v]);(0,n.useEffect)((()=>{localStorage.setItem("stopTab",v)}),[v]);const b=(0,n.useCallback)((e=>{var t;x(e),null===(t=u.current)||void 0===t||t.changeTab(e)}),[]);return(0,h.jsxs)(s.Z,{sx:{...k,bgcolor:m,backgroundImage:""===v?"url(/img/stop-bookmark-guide-".concat(r,"-").concat(c,".png)"):"unset",opacity:""===v?"0.8":"unset"},square:!0,elevation:0,children:[(0,h.jsx)(g,{stopTab:v,onChangeTab:b}),(0,h.jsx)(i.Z,{}),(0,h.jsx)(l.Z,{}),(0,h.jsx)(o.Z,{sx:{flex:1,overflow:"scroll"},children:(0,h.jsx)(f,{ref:u,stopTab:v,onChangeTab:b})})]})},k={textAlign:"center",display:"flex",flexDirection:"column",overflow:"auto",width:"100%",flex:1,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"}},7822:(e,t,r)=>{var n=r(4836);t.Z=void 0;var a=n(r(5045)),s=r(6417),o=(0,a.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");t.Z=o},5281:(e,t,r)=>{r.d(t,{Z:()=>M});var n=r(7186),a=r(7313),s=r(3061),o=r(1921),i=r(686),l=r(1615),c=r(7342),u=r(7592),d=r(7430),p=r(2298);function h(e){return(0,p.Z)("MuiCircularProgress",e)}(0,d.Z)("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);var g,v,x,m,f=r(6417);let b,k,Z,C;const S=44,j=(0,i.F4)(b||(b=g||(g=(0,n.Z)(["\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n"])))),y=(0,i.F4)(k||(k=v||(v=(0,n.Z)(["\n  0% {\n    stroke-dasharray: 1px, 200px;\n    stroke-dashoffset: 0;\n  }\n\n  50% {\n    stroke-dasharray: 100px, 200px;\n    stroke-dashoffset: -15px;\n  }\n\n  100% {\n    stroke-dasharray: 100px, 200px;\n    stroke-dashoffset: -125px;\n  }\n"])))),w=(0,u.ZP)("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t["color".concat((0,l.Z)(r.color))]]}})((e=>{let{ownerState:t,theme:r}=e;return{display:"inline-block",..."determinate"===t.variant&&{transition:r.transitions.create("transform")},..."inherit"!==t.color&&{color:(r.vars||r).palette[t.color].main}}}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&(0,i.iv)(Z||(Z=x||(x=(0,n.Z)(["\n      animation: "," 1.4s linear infinite;\n    "]))),j)})),T=(0,u.ZP)("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),R=(0,u.ZP)("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.circle,t["circle".concat((0,l.Z)(r.variant))],r.disableShrink&&t.circleDisableShrink]}})((e=>{let{ownerState:t,theme:r}=e;return{stroke:"currentColor",..."determinate"===t.variant&&{transition:r.transitions.create("stroke-dashoffset")},..."indeterminate"===t.variant&&{strokeDasharray:"80px, 200px",strokeDashoffset:0}}}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&!t.disableShrink&&(0,i.iv)(C||(C=m||(m=(0,n.Z)(["\n      animation: "," 1.4s ease-in-out infinite;\n    "]))),y)})),M=a.forwardRef((function(e,t){const r=(0,c.Z)({props:e,name:"MuiCircularProgress"}),{className:n,color:a="primary",disableShrink:i=!1,size:u=40,style:d,thickness:p=3.6,value:g=0,variant:v="indeterminate",...x}=r,m={...r,color:a,disableShrink:i,size:u,thickness:p,value:g,variant:v},b=(e=>{const{classes:t,variant:r,color:n,disableShrink:a}=e,s={root:["root",r,"color".concat((0,l.Z)(n))],svg:["svg"],circle:["circle","circle".concat((0,l.Z)(r)),a&&"circleDisableShrink"]};return(0,o.Z)(s,h,t)})(m),k={},Z={},C={};if("determinate"===v){const e=2*Math.PI*((S-p)/2);k.strokeDasharray=e.toFixed(3),C["aria-valuenow"]=Math.round(g),k.strokeDashoffset="".concat(((100-g)/100*e).toFixed(3),"px"),Z.transform="rotate(-90deg)"}return(0,f.jsx)(w,{className:(0,s.Z)(b.root,n),style:{width:u,height:u,...Z,...d},ownerState:m,ref:t,role:"progressbar",...C,...x,children:(0,f.jsx)(T,{className:b.svg,ownerState:m,viewBox:"".concat(22," ").concat(22," ").concat(S," ").concat(S),children:(0,f.jsx)(R,{className:b.circle,style:k,ownerState:m,cx:S,cy:S,r:(S-p)/2,fill:"none",strokeWidth:p})})})}))}}]);