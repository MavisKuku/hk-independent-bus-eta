"use strict";(self.webpackChunkhk_independent_bus_eta=self.webpackChunkhk_independent_bus_eta||[]).push([[516],{5516:(e,t,n)=>{n.r(t),n.d(t,{default:()=>de});var r=n(7313),s=n(6060),a=n(7829),i=n(9099),l=n(9019),o=n(2720),c=n(1479),d=n(9563),u=n(6417);const h=e=>{let{k:t,handleClick:n,disabled:r=!1,sx:s}=e;return(0,u.jsx)(i.Z,{size:"large",variant:"contained",sx:{...m,...s},onClick:()=>n(t),disabled:r,disableRipple:!0,children:"b"===t?(0,u.jsx)(o.Z,{}):"c"===t?(0,u.jsx)(c.Z,{}):t})},x=e=>{let{possibleChar:t}=e;const{numPadOrder:n,searchRoute:a,updateSearchRouteByButton:i}=(0,r.useContext)(s.ZP);return(0,u.jsx)(l.ZP,{container:!0,spacing:0,children:n.split("").map((e=>(0,u.jsx)(l.ZP,{item:!0,xs:4,children:(0,u.jsx)(h,{k:e,handleClick:i,sx:j,disabled:"b"===e&&""===a||!"bc".includes(e)&&!t.includes(e)||"c"===e&&""===a})},"input-"+e)))})},p=e=>{let{possibleChar:t}=e;const{updateSearchRouteByButton:n}=(0,r.useContext)(s.ZP);return(0,u.jsx)(l.ZP,{container:!0,spacing:1,children:t.filter((e=>isNaN(parseInt(e,10)))).map((e=>(0,u.jsx)(l.ZP,{item:!0,xs:6,children:(0,u.jsx)(h,{k:e,handleClick:n,sx:f})},"input-"+e)))})},b=e=>{let{boardTab:t}=e;const{searchRoute:n,db:{routeList:i}}=(0,r.useContext)(s.ZP),l=v(n,i,t);return"prerendering"===navigator.userAgent?(0,u.jsx)(u.Fragment,{}):(0,u.jsxs)(a.Z,{sx:g,padding:0,children:[(0,u.jsx)(a.Z,{sx:C,padding:0,children:(0,u.jsx)(x,{possibleChar:l})}),(0,u.jsx)(a.Z,{sx:Z,padding:0,children:(0,u.jsx)(p,{possibleChar:l})})]})},g={zIndex:0,background:e=>e.palette.background.default,display:"flex",flexDirection:"row",height:"248px",justifyContent:"space-around"},m={background:e=>e.palette.background.paper,color:e=>e.palette.text.primary,width:"100%",fontSize:"1.8em",borderRadius:"unset","&:selected":{color:e=>e.palette.text.primary},"&:hover":{backgroundColor:e=>e.palette.background.paper}},j={height:"62px"},f={height:"52px"},Z={width:"35%",height:"246px",overflowX:"hidden",overflowY:"scroll"},C={width:"62%"},v=(e,t,n)=>{if(null==t)return[];let r={};return Object.entries(t).forEach((t=>{let[s,a]=t;if(s.startsWith(e.toUpperCase())&&a.co.some((e=>d.nR[n].includes(e)))){let t=s.slice(e.length,e.length+1);r[t]=isNaN(r[t])?1:r[t]+1}})),Object.entries(r).map((e=>e[0])).filter((e=>"-"!==e))};var y=n(4511),k=n(5823),S=n(8485),w=n(5280);const T=e=>{let{boardTab:t,onChangeTab:n}=e;const{t:i}=(0,y.$)(),{isRecentSearchShown:l}=(0,r.useContext)(s.ZP);return(0,u.jsx)(a.Z,{children:(0,u.jsx)(S.Z,{value:t,onChange:(e,t)=>n(t,!0),sx:R,children:Object.keys(d.nR).filter((e=>l||"recent"!==e)).map((e=>(0,u.jsx)(w.Z,{label:i(e),value:e,disableRipple:!0},e)))})})},R={background:e=>e.palette.background.default,minHeight:"36px",overflow:"auto",maxWidth:"100%","& .MuiTab-root":{py:0,minWidth:"85px",minHeight:"32px","&.MuiButtonBase-root":{textTransform:"none"}},"& .MuiTabs-scroller":{overflow:"auto !important"}};var P=n(2547),I=n(275),D=n(2429),M=n(3165),B=n(8566),L=n(6912),z=n(1113),F=n(3135),O=n(3428),$=n(4183),H=n(3405),N=n(7131),W=n(2135);const _=e=>{let{terminus:t}=e;const{t:n,i18n:r}=(0,y.$)();return(0,u.jsxs)(a.Z,{sx:A,children:[(0,u.jsxs)(a.Z,{sx:U,children:[(0,u.jsx)("span",{children:"".concat(n("\u5f80")," ")}),(0,u.jsx)(z.Z,{component:"h3",variant:"h6",sx:X,children:(0,k.iF)(t.dest[r.language])})]}),(0,u.jsx)(a.Z,{sx:E,children:(0,u.jsx)(z.Z,{variant:"body2",children:(0,k.iF)(t.orig[r.language])})})]})},A={textAlign:"left","& > span":{}},U={display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden","& > span":{fontSize:"0.95em",mr:.5}},E={display:"flex",alignItems:"baseline",whiteSpace:"nowrap",overflowX:"hidden"},X={fontWeight:700};var Y=n(9530);const q=e=>{let{route:t}=e;const{t:n}=(0,y.$)(),[r,s]=t[0].split("-").slice(0,2);return(0,u.jsxs)(a.Z,{children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(Y.Z,{routeNo:r}),parseInt(s,10)>=2&&(0,u.jsx)(z.Z,{variant:"caption",sx:J,children:n("\u7279\u5225\u73ed")})]}),(0,u.jsx)(z.Z,{component:"h4",variant:"caption",sx:G,children:t[1].co.map((e=>n(e))).join("+")})]})},G={color:e=>e.palette.text.secondary},J={fontSize:"0.6rem",marginLeft:"8px"};var K=n(8586);const Q=e=>{let{route:t,handleClick:n,style:r,onRemove:s}=e;const{i18n:a}=(0,y.$)();return(0,u.jsx)(W.rU,{to:"/".concat(a.language,"/route/").concat(t[0].toLowerCase()),style:r,children:(0,u.jsxs)(O.Z,{variant:"outlined",square:!0,sx:V,children:[(0,u.jsx)($.Z,{onClick:n,children:(0,u.jsxs)(H.Z,{sx:ee,children:[(0,u.jsx)(q,{route:t}),(0,u.jsx)(_,{terminus:t[1]})]})}),null!==s&&(0,u.jsx)(N.Z,{onClick:s,children:(0,u.jsx)(K.Z,{})})]},t[0])})},V={border:"none",display:"flex",alignItems:"center"},ee={display:"grid",gridTemplateColumns:"25% 65%",py:.5,px:2,alignItems:"center"};var te=n(8467);const ne=r.memo((e=>{let{data:{routeList:t,vibrateDuration:n,tab:a},index:i,style:l}=e;const o=t[i],{addSearchHistory:c,removeSearchHistoryByRouteId:d}=(0,r.useContext)(s.ZP),{i18n:h}=(0,y.$)(),x=(0,te.s0)();return(0,u.jsx)(Q,{handleClick:e=>{e.preventDefault(),(0,k.tp)(n),c(o[0]),setTimeout((()=>{x("/".concat(h.language,"/route/").concat(o[0].toLowerCase()))}),0)},route:o,style:l,onRemove:"recent"===a?e=>{e.preventDefault(),(0,k.tp)(n),d(o[0])}:null})}),M.wy),re=(0,L.Z)(((e,t,n)=>({routeList:e,vibrateDuration:t,tab:n}))),se=(0,I.yP)((0,I.p6)(P.ZP)),ae=e=>{let{boardTab:t,onChangeTab:n}=e;const{searchRoute:i,db:{holidays:l,routeList:o,serviceDayMap:c},isRouteFilter:h,busSortOrder:x,routeSearchHistory:p,vibrateDuration:b,isRecentSearchShown:g}=(0,r.useContext)(s.ZP),m=(0,r.useMemo)((()=>(0,F.HD)(l,new Date)),[l]),{t:j}=(0,y.$)(),f=(0,r.useMemo)((()=>{const e=Object.entries(o).filter((e=>{let[t,{stops:n,co:r}]=e;return t.startsWith(i.toUpperCase())&&(null==n[r[0]]||n[r[0]].length>0)})).filter((e=>{let[t,{freq:n}]=e;return!h||(0,F.x4)(t,n,m,c)})).sort(((e,t)=>(0,k.nO)(e,t,d.Y$[x])));return Object.entries(d.nR).filter((e=>{let[t]=e;return g||"recent"!==t})).map(((t,n)=>{let[r,s]=t;return re("recent"===r?p.filter((e=>e.startsWith(i.toUpperCase()))).filter((e=>o[e])).map((e=>[e,o[e]])):e.filter((e=>{let[t,{co:n}]=e;return n.some((e=>s.includes(e)))})),b,r)}))}),[o,m,i,h,b,x,p,g,c]),Z=(0,r.useMemo)((()=>{const e=parseInt(getComputedStyle(document.body).fontSize,10);return e<=18?64:e<=22?78:e<=26?92:e<=30?98:110}),[]),C=(0,r.useCallback)((e=>{let{key:t,index:n}=e;return(0,u.jsx)(r.Fragment,{children:f[n].routeList.length>0?(0,u.jsx)(B.Z,{children:e=>{let{height:t,width:r}=e;return(0,u.jsx)(M.t7,{height:.98*t,itemCount:f[n].routeList.length,itemSize:Z,width:r,itemData:f[n],children:ne})}}):(0,u.jsxs)(a.Z,{sx:oe,children:[(0,u.jsx)(D.Z,{fontSize:"small"}),(0,u.jsx)(a.Z,{children:n>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(z.Z,{variant:"h6",children:['"',i,'"']}),(0,u.jsx)(z.Z,{variant:"h6",children:j("route-search-no-result")})]}):(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(z.Z,{variant:"h6",children:j("no-recent-search")})})})]})},t)}),[Z,f,i,j]),v=(0,r.useMemo)((()=>ie.filter((e=>g||"recent"!==e))),[g]);return(0,r.useMemo)((()=>(0,u.jsx)(u.Fragment,{children:"prerendering"===navigator.userAgent?(0,u.jsx)(a.Z,{sx:le,children:f[0].routeList.map(((e,t)=>(0,u.jsx)(ne,{data:f[0],index:t,style:null},"route-".concat(t))))}):(0,u.jsx)(se,{index:v.indexOf(t),onChangeIndex:e=>{n(v[e])},style:{flex:1,display:"flex"},containerStyle:{flex:1},slideCount:f.length,overscanSlideAfter:1,overscanSlideBefore:1,slideRenderer:C,enableMouseEvents:!0})})),[C,f,n,t,v])},ie=["recent","all","bus","minibus","lightRail","mtr"],le={height:"100%",overflowY:"scroll"},oe={height:"140px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center","& .MuiSvgIcon-root":{fontSize:"4em",mr:2}},ce=e=>{let{boardTab:t,setBoardTab:n}=e;const{AppTitle:i}=(0,r.useContext)(s.ZP),{t:l,i18n:o}=(0,y.$)();(0,r.useEffect)((()=>{(0,k.ND)({title:l("\u641c\u5c0b")+" - "+l(i),description:l("route-board-page-description"),lang:o.language})}),[o.language]);const c=(0,r.useCallback)((e=>{n(e),localStorage.setItem("boardTab",e)}),[n]);return(0,u.jsxs)(a.Z,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[(0,u.jsx)(T,{boardTab:t,onChangeTab:c}),(0,u.jsx)(ae,{boardTab:t,onChangeTab:c})]})},de=()=>{const{isRecentSearchShown:e}=(0,r.useContext)(s.ZP),t=localStorage.getItem("boardTab"),[n,a]=(0,r.useState)(((e,t)=>t&&"recent"===e||"all"===e||"bus"===e||"minibus"===e||"lightRail"===e||"mtr"===e)(t,e)?t:"all");return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ce,{boardTab:n,setBoardTab:a}),(0,u.jsx)(b,{boardTab:n})]})}}}]);